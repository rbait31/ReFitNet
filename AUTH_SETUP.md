# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google OAuth –¥–ª—è ReFitNet

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`next-auth`, `@auth/prisma-adapter`)
2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ Prisma schema (–¥–æ–±–∞–≤–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏ –¥–ª—è Auth.js)
3. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Auth.js (`auth.ts`)
4. ‚úÖ –°–æ–∑–¥–∞–Ω API route –¥–ª—è NextAuth
5. ‚úÖ –°–æ–∑–¥–∞–Ω middleware –¥–ª—è –∑–∞—â–∏—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü
6. ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã `/login` –∏ `/dashboard`
7. ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
8. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `.env` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Prisma

```bash
npm run db:push
```

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ EPERM, –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` –µ—Å—Ç—å:

```env
# Google OAuth
GOOGLE_CLIENT_ID=–≤–∞—à_client_id
GOOGLE_CLIENT_SECRET=–≤–∞—à_client_secret

# Auth.js Secret
AUTH_SECRET=—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç
NEXTAUTH_SECRET=—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç
NEXTAUTH_URL=http://localhost:3000

# Database
DATABASE_URL=–≤–∞—à–∞_—Å—Ç—Ä–æ–∫–∞_–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Google Cloud Console

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Google Cloud Console](https://console.cloud.google.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **APIs & Services** ‚Üí **Credentials**
3. –°–æ–∑–¥–∞–π—Ç–µ OAuth 2.0 Client ID (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω)
4. –í —Ä–∞–∑–¥–µ–ª–µ **Authorized redirect URIs** –¥–æ–±–∞–≤—å—Ç–µ:
   ```
   http://localhost:3000/api/auth/callback/google
   ```
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Client ID** –∏ **Client Secret** –≤ `.env`

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç

```bash
npm run dev
```

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000/login`
2. –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google"
3. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –≤—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ `/dashboard`

## üîí –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–°–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞—â–∏—â–µ–Ω—ã middleware –∏ —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
- `/dashboard` - –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
- `/my-prompts` - –º–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç—è—Ç—Å—è –Ω–∞ `/login`.

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Server-side –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏

```typescript
import { getServerSession } from "next-auth/next"
import { authOptions } from "@/auth"

export default async function ProtectedPage() {
  const session = await getServerSession(authOptions)
  
  if (!session) {
    redirect("/login")
  }
  
  // session.user.id - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  // session.user.email - Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  // session.user.name - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  // session.user.image - –ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
}
```

### Client-side –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏

```typescript
"use client"

import { useSession } from "next-auth/react"

export function MyComponent() {
  const { data: session, status } = useSession()
  
  if (status === "loading") return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  if (!session) return <div>–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</div>
  
  return <div>–ü—Ä–∏–≤–µ—Ç, {session.user.name}!</div>
}
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google OAuth
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–≤—è–∑–∞–Ω—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —á–µ—Ä–µ–∑ `userId`
- ‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ

